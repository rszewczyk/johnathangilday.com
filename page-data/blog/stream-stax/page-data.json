{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/stream-stax/","result":{"data":{"site":{"siteMetadata":{"author":{"name":"Johnathan Gilday"},"blogTitle":"/ gilday / blog"}},"markdownRemark":{"id":"c1bc6163-34a5-5254-82ba-b03939f15bcd","excerpt":"I recently had to process large XML documents in Java, so I reached for Java’s\nStreaming API for XML (StAX). The document had a long list of relatively small…","html":"<p>I recently had to process large XML documents in Java, so I reached for Java’s\nStreaming API for XML (StAX). The document had a long list of relatively small\nelements. Java’s new switch expressions made parsing the XML with StAX much\nnicer than I remembered; however, I found myself missing the filtering,\ntransformation, and aggregation methods from <code>java.util.stream.Stream</code>.</p>\n<p>I wanted to use StAX to parse the XML elements into a Java record, and I wanted\nto use a <code>Stream</code> to process those records. In this blog post, I detail how to\ndo that efficiently.</p>\n<h2>Parsing All the Sandwiches</h2>\n<p>Consider an arbitrarily large XML document containing a list of favorite\nsandwiches. Of course, we could parse all the favorite sandwiches into a\n<code>java.util.Collection</code> then call <code>stream()</code>. However, we know this is not\nefficient, because it requires the JVM to hold all the data from the large XML\ndocument in memory.</p>\n<pre class=\"grvsc-container solarized-light grvsc-mm-t6zo1R\" data-language=\"java\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-3 grvsc-tiaGIi-i grvsc-t6zo1R-3 grvsc-t6zo1R-i\">// 🤢 Inefficient, because it reads all the records into memory before processing</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">List</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">&lt;</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">FavoriteSandwich</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">&gt; </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">sandwiches</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">parseAllSandwiches</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span><span class=\"grvsc-tiaGIi-11 grvsc-t6zo1R-12\">&quot;./sandwiches.xml&quot;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">Stream</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">sandwichesStream</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">sandwiches</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">stream</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">();</span></span></span></code></pre>\n<p>Instead, we want a <code>Stream</code> that parses the XML data as-needed. To build such a\nstream, we define a new type that implements <code>java.util.stream.Spliterator</code>\ninterface. A <code>Spliterator</code> is the <code>java.util.stream</code> equivalent of a cursor, and\nit facilitates making new <code>Stream</code> instances from data that can be iterated on\nand optionally partitioned. In this example, the XML data is given to the\n<code>Spliterator</code> as an <code>InputStream</code>, so it cannot be partitioned.</p>\n<pre class=\"grvsc-container solarized-light grvsc-mm-t6zo1R\" data-language=\"java\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">class</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-4\">FavoriteSandwichXMLSpliterator</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">implements</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-8\">Spliterator</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">&lt;</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">FavoriteSandwich</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">&gt; {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">private</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">final</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">XMLEventReader</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">reader</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">public</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">FavoriteSandwichXMLSpliterator</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">final</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">InputStream</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> is) </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">throws</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">IOException</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">try</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      reader </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">factory</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">createXMLEventReader</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(is);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    } </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">catch</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> (</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">XMLStreamException</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> e) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">throw</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">new</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">IOException</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span><span class=\"grvsc-tiaGIi-11 grvsc-t6zo1R-12\">&quot;Failed to parse favorite sandwiches from XML&quot;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">, e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  ...</span></span></span></code></pre>\n<p>The <code>Spliterator</code> parses the XML as-needed in its <code>tryAdvance</code> method.</p>\n<pre class=\"grvsc-container solarized-light grvsc-mm-t6zo1R\" data-language=\"java\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">@</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">public</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">boolean</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">tryAdvance</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">final</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">Consumer</span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">&lt;?</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">super</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> FavoriteSandwich</span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> action) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">while</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> (</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">reader</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">hasNext</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">final</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">XMLEvent</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">event</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">try</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      event </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">reader</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">nextEvent</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    } </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">catch</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> (</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">XMLStreamException</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> e) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">throw</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">new</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">UncheckedXMLStreamException</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span><span class=\"grvsc-tiaGIi-11 grvsc-t6zo1R-12\">&quot;Failed to read favorite sandwiches from XML&quot;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">, e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">if</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> (</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">event</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">isStartElement</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">final</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">StartElement</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">startElement</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">event</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">asStartElement</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">if</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> (</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">startElement</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">getName</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">().</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">getLocalPart</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">().</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">equals</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span><span class=\"grvsc-tiaGIi-11 grvsc-t6zo1R-12\">&quot;favorite-sandwich&quot;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">        </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">final</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">FavoriteSandwich</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">sandwich</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">        </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">try</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">          sandwich </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">readSandwich</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(); </span><span class=\"grvsc-tiaGIi-3 grvsc-tiaGIi-i grvsc-t6zo1R-3 grvsc-t6zo1R-i\">// implementation omitted for brevity</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">        } </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">catch</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> (</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">XMLStreamException</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> e) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">          </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">throw</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">new</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">UncheckedXMLStreamException</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span><span class=\"grvsc-tiaGIi-11 grvsc-t6zo1R-12\">&quot;Failed to read favorite sandwich from XML&quot;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">, e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">        </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">action</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">accept</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(sandwich);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">        </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">return</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-5 grvsc-t6zo1R-5\">true</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">return</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-5 grvsc-t6zo1R-5\">false</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">}</span></span></span></code></pre>\n<p>The remaining methods of the <code>Spliterator</code> interface return values that\ncommunicate to the <code>Stream</code> that we do not know how long the <code>Stream</code> is and it\ncannot be partitioned. Finally, all this is encapsulated in a factory method\nthat returns a new <code>Stream</code>.</p>\n<pre class=\"grvsc-container solarized-light grvsc-mm-t6zo1R\" data-language=\"java\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">public</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">Stream</span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">&lt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">FavoriteSandwich</span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">stream</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">final</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">InputStream</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> is) throws IOException {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">final</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">var</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">spliterator</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">new</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">FavoriteSandwichXMLSpliterator</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(is);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">return</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">StreamSupport</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">stream</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(spliterator, </span><span class=\"grvsc-tiaGIi-5 grvsc-t6zo1R-5\">false</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">}</span></span></span></code></pre>\n<p>This factory method provides the <code>Stream&#x3C;FavoriteSandwich></code> that developers want\nto use while encapsulating the XML parsing that developers do not want to think\nabout. For example, it’s now incredibly simple to compute a count of favorite\nsandwiches by the U.S. state they’re from:</p>\n<pre class=\"grvsc-container solarized-light grvsc-mm-t6zo1R\" data-language=\"java\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">@</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">Test</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">void</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">stream_all_valid_sandwiches</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">() throws IOException {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">final</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">FavoriteSandwichXMLParser</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">reader</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">new</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">FavoriteSandwichXMLParser</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">try</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> (</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">var</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">is</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">FavoriteSandwichXMLParserTest</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">class</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">getResourceAsStream</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span><span class=\"grvsc-tiaGIi-11 grvsc-t6zo1R-12\">&quot;/favorite-sandwiches.xml&quot;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">var</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">sandwiches</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">reader</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">stream</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(is);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">final</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">Map</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">&lt;</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">String</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">, </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">Long</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">&gt; </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">countByState</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">        </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">sandwiches</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">collect</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">            </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">groupingBy</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(sandwich </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">-&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">sandwich</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">restaurant</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">().</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">state</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(), </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">Collectors</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">counting</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">()));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">final</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">Map</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">&lt;</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">String</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">, </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">Long</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">&gt; </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">expected</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">Map</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">of</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span><span class=\"grvsc-tiaGIi-11 grvsc-t6zo1R-12\">&quot;NJ&quot;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">, </span><span class=\"grvsc-tiaGIi-6 grvsc-t6zo1R-6\">2L</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">, </span><span class=\"grvsc-tiaGIi-11 grvsc-t6zo1R-12\">&quot;MD&quot;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">, </span><span class=\"grvsc-tiaGIi-6 grvsc-t6zo1R-6\">3L</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">assertThat</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(countByState).</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">containsExactlyInAnyOrderEntriesOf</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(expected);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">}</span></span></span></code></pre>\n<p>Perfect! 🥪</p>\n<h2>Resource Management Special Case</h2>\n<p>In the previous example, the <code>Stream&#x3C;FavoriteSandwich></code> data was processed\nentirely within a try-with-resources statement that ensures the <code>InputStream</code>\nwill be closed. While this is ideal, it may not always be possible to manage the\nIO resources this way. For example, consider the case where some existing method\nexpects a <code>Supplier&#x3C;Stream&#x3C;FavoriteSandwich>></code>. In this case, the <code>Supplier</code>\ncannot use try-with-resources, because it cannot know when to close the\n<code>InputStream</code>.</p>\n<pre class=\"grvsc-container solarized-light grvsc-mm-t6zo1R\" data-language=\"java\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-3 grvsc-tiaGIi-i grvsc-t6zo1R-3 grvsc-t6zo1R-i\">// 🐛 Will close the InputStream before any code can operate on the Stream</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">Supplier</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">&lt;</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">Stream</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">&lt;</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">FavoriteSandwich</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">&gt;&gt; </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">supplier</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> () </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">-&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">try</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> (</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">var</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">is</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">FavoriteSandwichXMLParserTest</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">class</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">getResourceAsStream</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span><span class=\"grvsc-tiaGIi-11 grvsc-t6zo1R-12\">&quot;/favorite-sandwiches.xml&quot;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">return</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">reader</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">stream</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(is);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  } </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">catch</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> (</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">IOException</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> e) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">throw</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">new</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">UncheckedIOException</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">};</span></span></span></code></pre>\n<p>Instead, we want to clean-up the resources when the <code>Stream</code> has been closed.\nFortunately, <code>Stream</code> implements <code>AutoCloseable</code>, and the\n<a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/stream/Stream.html\">Stream Javadoc</a>\ninstructs users to close streams that are backed by an IO channel.</p>\n<blockquote>\n<p>Streams have a BaseStream.close() method and implement AutoCloseable, but\nnearly all stream instances do not actually need to be closed after use.\nGenerally, only streams whose source is an IO channel (such as those returned\nby Files.lines(Path, Charset)) will require closing. Most streams are backed\nby collections, arrays, or generating functions, which require no special\nresource management. (If a stream does require closing, it can be declared as\na resource in a try-with-resources statement.)</p>\n</blockquote>\n<p>We can take advantage of this to handle this special case where the <code>Stream</code>\nmust clean-up the IO channel it encapsulates.</p>\n<p>First, we make the <code>FavoriteSandwichXMLSpliterator</code> implement <code>AutoCloseable</code>.\nThe <code>close()</code> method simply closes the <code>InputStream</code> passed to the constructor\nand propagates any exceptions as a <code>RuntimeException</code>.</p>\n<pre class=\"grvsc-container solarized-light grvsc-mm-t6zo1R\" data-language=\"java\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">@</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">Override</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">public</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">void</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">close</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">try</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">reader</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">close</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  } </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">catch</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> (</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">XMLStreamException</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> e) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">throw</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">new</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">UncheckedXMLStreamException</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span><span class=\"grvsc-tiaGIi-11 grvsc-t6zo1R-12\">&quot;Failed to close XMLEventReader&quot;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">, e);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">}</span></span></span></code></pre>\n<p>In this case, we define a new runtime exception <code>UncheckedXMLStreamException</code>\nthat is the StAX analog to <code>UncheckedIOException</code>.</p>\n<p>Lastly, we change the factory that creates the <code>Stream</code>, so that the <code>Stream</code>\ncloses the <code>Spliterator</code> when it has been closed. This is made possible by the\n<code>Stream.onClose(Runnable)</code> method that allows users to schedule arbitrary\nroutines to be executed when the <code>Stream</code> is closed.</p>\n<pre class=\"grvsc-container solarized-light grvsc-mm-t6zo1R\" data-language=\"java\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">public</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">Stream</span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">&lt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">FavoriteSandwich</span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">stream</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">final</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">InputStream</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> is) throws IOException {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">final</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">var</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">spliterator</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">new</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">FavoriteSandwichXMLSpliterator</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(is);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">return</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">StreamSupport</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">stream</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(spliterator, </span><span class=\"grvsc-tiaGIi-5 grvsc-t6zo1R-5\">false</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">).</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">onClose</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(spliterator</span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">::</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">close);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">}</span></span></span></code></pre>\n<p>Having made these changes, the <code>Stream</code> itself may be in a try-with-resources to\nensure that the IO is closed properly:</p>\n<pre class=\"grvsc-container solarized-light grvsc-mm-t6zo1R\" data-language=\"java\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">void</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">process</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">final</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">Supplier</span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">&lt;</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">Stream</span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">&lt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">FavoriteSandwich</span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">&gt;&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> supplier) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">try</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> (</span><span class=\"grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b\">var</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">sandwiches</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">=</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\"> </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">supplier</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">get</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">()) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">sandwiches</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">forEach</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">(</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">System</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">.</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">out</span><span class=\"grvsc-tiaGIi-8 grvsc-t6zo1R-9\">::</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">println);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">}</span></span></span></code></pre>\n<h2>Conclusion</h2>\n<p>Arbitrarily large streams of data, such as a large XML document, are ripe for\nprocessing with the <code>java.util.stream</code> APIs, but developers need way to parse\nrecords from the stream as-needed and expose those elements as a <code>Stream</code>. The\n<code>Spliterator</code> interface is the key that unlocks the power of the <code>Stream</code> API\nfor data that may be processed stream-wise. Additionally, when the <code>Stream</code> must\nalso clean-up the underlying IO resources after it has been exhausted, the\n<code>Stream.onClose(Runnable)</code> method is available to schedule that clean-up.</p>\n<p>The accompanying code may be found at\n<a href=\"https://github.com/gilday/how-to-stream-stax\">gilday/how-to-stream-stax</a>.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .solarized-light { background-color: #FDF6E3; }\n  .solarized-light .grvsc-tiaGIi-b { font-weight: bold; }\n  .solarized-light .grvsc-tiaGIi-i { font-style: italic; }\n  .solarized-light .grvsc-tiaGIi-3 { color: #93A1A1; }\n  .solarized-light .grvsc-tiaGIi-13 { color: #073642; }\n  .solarized-light .grvsc-tiaGIi-1 { color: #657B83; }\n  .solarized-light .grvsc-tiaGIi-7 { color: #268BD2; }\n  .solarized-light .grvsc-tiaGIi-8 { color: #859900; }\n  .solarized-light .grvsc-tiaGIi-11 { color: #2AA198; }\n  .solarized-light .grvsc-tiaGIi-5 { color: #B58900; }\n  .solarized-light .grvsc-tiaGIi-6 { color: #D33682; }\n  .solarized-light .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n  \n  /* Solarized Dark */\n  @media (prefers-color-scheme: dark) {\n    .grvsc-mm-t6zo1R { background-color: #002B36; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-b { font-weight: bold; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-i { font-style: italic; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-3 { color: #657B83; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-1 { color: #93A1A1; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-7 { color: #268BD2; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-9 { color: #859900; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-12 { color: #2AA198; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-4 { color: #CB4B16; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-8 { color: #6C71C4; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-5 { color: #B58900; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-6 { color: #D33682; }\n    .grvsc-mm-t6zo1R .grvsc-line-highlighted::before {\n      background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n      box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n    }\n  }\n</style>","frontmatter":{"title":"☕️ Connecting Java's Streaming API for XML (StAX) with Streams","date":"December 15, 2022","description":"On one hand, Java developers love to work with streams of data using the `java.util.stream` package, because it is easy to apply transformations, filtering, and aggregation. On the other hand, the Streaming API for XML (StAX) makes reading XML streamwise easy, but there are no easy ways to filter, transform, and aggregate the data. How can a Java developer connect these two APIs to use the best of both?\n"}}},"pageContext":{"slug":"/blog/stream-stax/","previous":{"fields":{"slug":"/blog/maven-toolchain-tests/","sourceName":"blog"},"frontmatter":{"title":"🦉 Testing Across JDKs with Maven Toolchains"}},"next":{"fields":{"slug":"/blog/java-nio-files/","sourceName":"blog"},"frontmatter":{"title":"☕️ Reasons to Prefer Java's New I/O for Working With Files"}}}},"staticQueryHashes":["2841359383","614056702"],"slicesMap":{}}