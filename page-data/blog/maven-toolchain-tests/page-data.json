{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/maven-toolchain-tests/","result":{"data":{"site":{"siteMetadata":{"author":{"name":"Johnathan Gilday"},"blogTitle":"/ gilday / blog"}},"markdownRemark":{"id":"25297dbd-5299-549b-ab0e-6a84964f23e3","excerpt":"Some Maven users need to verify that their Java project is compatible with\nmultiple JDKs. Typically, users perform this testing by configuring their CI to\nre…","html":"<p>Some Maven users need to verify that their Java project is compatible with\nmultiple JDKs. Typically, users perform this testing by configuring their CI to\nre-run their Maven build with each such JDK. This works, but there are some\ndownsides:</p>\n<ul>\n<li>\n<p><strong>Restarting the whole build is slow.</strong> You only want to re-run the tests, but\nre-running the build means you have to re-run phases prior to the testing\nphase as well. If you’re running integration tests, this means recompiling and\nrepackaging you application each time.</p>\n</li>\n<li>\n<p><strong>Your entire Maven build must be compatible with each JDK version you need to\ntest with.</strong> Suppose you want to test your application with JDK 1.7, but you\nrely on Maven plugins that require JDK 1.8. When you re-run the Maven build\nwith JDK 1.7, those Maven plugins will not work.</p>\n</li>\n<li>\n<p><strong>Rebuilding the artifact reduces fidelity in testing.</strong> Your goal is to test\nthe Java artifacts you intend to release. However, when you re-run the build,\nyou produce new artifacts each time. There’s little chance this will lead to\nmeaningful incompatibilities, but why leave it to chance.</p>\n</li>\n</ul>\n<h2>Configuring Maven Toolchains</h2>\n<p><a href=\"https://maven.apache.org/guides/mini/guide-using-toolchains.html\">Maven’s Toolchains feature</a>\nhelps users include different JDKs throughout their build. This helps to\nseparate your build’s JDK requirements from the JDK you use to compile and test\nyour code. In this post, we’ll configure a Maven build to run integration tests\nwith multiple JDKs using Maven Toolchains.</p>\n<p>Before you can use Maven Toolchains, you must have\n<a href=\"https://maven.apache.org/ref/3.8.1/maven-core/toolchains.html\">configured a toolchains.xml</a>.\nThe file belongs in <code>$M2_HOME/toolchains.xml</code>. This example has two JDKs\ndefined:</p>\n<pre class=\"grvsc-container solarized-light grvsc-mm-t6zo1R\" data-language=\"xml\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;?</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">xml</span><span class=\"grvsc-tiaGIi-3 grvsc-t6zo1R-1\"> version</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">=</span><span class=\"grvsc-tiaGIi-11 grvsc-t6zo1R-12\">&quot;1.0&quot;</span><span class=\"grvsc-tiaGIi-3 grvsc-t6zo1R-1\"> encoding</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">=</span><span class=\"grvsc-tiaGIi-11 grvsc-t6zo1R-12\">&quot;UTF8&quot;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">?&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">toolchains</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-3 grvsc-tiaGIi-i grvsc-t6zo1R-3 grvsc-t6zo1R-i\">&lt;!-- JDK toolchains --&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">toolchain</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">type</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">jdk</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">type</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">provides</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">version</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">1.8</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">version</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">vendor</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">eclipse</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">vendor</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">provides</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">configuration</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">jdkHome</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">/Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">jdkHome</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">configuration</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">toolchain</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">toolchain</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">type</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">jdk</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">type</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">provides</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">version</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">11</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">version</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">vendor</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">eclipse</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">vendor</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">provides</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">configuration</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">jdkHome</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">/Library/Java/JavaVirtualMachines/adoptopenjdk-11.jdk/Contents/Home</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">jdkHome</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">configuration</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">toolchain</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">toolchains</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span></code></pre>\n<h2>Configuring Multiple Test Runs</h2>\n<p>Maven runs unit tests with the Maven Surefire Plugin and integration tests with\nthe Maven Failsafe Plugin. Both of these plugins work with the Maven Toolchains\nfeature, and both may be configured to run the test suite multiple times with\ndifferent JDKs.</p>\n<p>In this example, we’ll configure the Maven Failsafe Plugin to run integration\ntests on JDKs 1.8 and 11. This is done by adding two distinct executions to the\nplugin (distinguished by the execution ID) that use different toolchains.</p>\n<pre class=\"grvsc-container solarized-light grvsc-mm-t6zo1R\" data-language=\"xml\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">plugin</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">artifactId</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">maven-failsafe-plugin</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">artifactId</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">executions</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">execution</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">id</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">jdk-1.8</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">id</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">goals</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">        </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">goal</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">integration-test</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">goal</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">        </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">goal</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">verify</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">goal</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">goals</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">configuration</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">        </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">jdkToolchain</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">1.8</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">jdkToolchain</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">configuration</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">execution</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">execution</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">id</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">jdk-11</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">id</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">goals</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">        </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">goal</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">integration-test</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">goal</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">        </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">goal</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">verify</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">goal</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">goals</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">configuration</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">        </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">jdkToolchain</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">11</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">jdkToolchain</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">      </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">configuration</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">    </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">execution</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-1\">  </span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">executions</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&lt;/</span><span class=\"grvsc-tiaGIi-7 grvsc-t6zo1R-7\">plugin</span><span class=\"grvsc-tiaGIi-1 grvsc-t6zo1R-3\">&gt;</span></span></span></code></pre>\n<p>Note that this only works with the 3.x releases of the Maven Surefire and\nFailsafe plugins. If you try this with the 2.x releases, then Maven will run the\nfirst execution and skip the second one with a message like:</p>\n<pre class=\"grvsc-container solarized-light grvsc-mm-t6zo1R\" data-language=\"\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] --- maven-failsafe-plugin:2.22.2:integration-test (jdk-11) @ maven-toolchains-testing ---</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] Skipping execution of surefire because it has already been run for this configuration</span></span></code></pre>\n<p>Having configured the Maven Failsafe Plugin with multiple executions, we can run\n<code>mvn verify</code> and note that the build output shows both executions:</p>\n<pre class=\"grvsc-container solarized-light grvsc-mm-t6zo1R\" data-language=\"\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">INFO] --- maven-failsafe-plugin:3.0.0-M5:integration-test (jdk-1.8) @ maven-toolchains-testing ---</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] Toolchain in maven-failsafe-plugin: JDK[/Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] -------------------------------------------------------</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO]  T E S T S</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] -------------------------------------------------------</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] Running com.github.gilday.AppIT</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 10.036 s - in com.github.gilday.AppIT</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] Results:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] --- maven-failsafe-plugin:3.0.0-M5:integration-test (jdk-11) @ maven-toolchains-testing ---</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] Toolchain in maven-failsafe-plugin: JDK[/Library/Java/JavaVirtualMachines/adoptopenjdk-11.jdk/Contents/Home]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] -------------------------------------------------------</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO]  T E S T S</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] -------------------------------------------------------</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] Running com.github.gilday.AppIT</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 10.034 s - in com.github.gilday.AppIT</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] Results:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] --- maven-failsafe-plugin:3.0.0-M5:verify (jdk-1.8) @ maven-toolchains-testing ---</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[INFO] --- maven-failsafe-plugin:3.0.0-M5:verify (jdk-11) @ maven-toolchains-testing ---</span></span></code></pre>\n<h2>Trade-Offs</h2>\n<p>We’ve already discussed the downsides of re-running Maven with different JDKs to\ntest across JDKs. Now, let’s consider the downside of this approach.</p>\n<p>When users configure their CI build to re-run Maven using different JDKs, they\ncan often configure the CI to run these distinct Maven builds in parallel. This\nalleviates the build time problem, because each build happens concurrently.</p>\n<p>With the Maven Toolchains strategy, we cannot run the tests across different\nJDKs concurrently. Maven’s multi-threaded build feature is limited to building\nmodules in the reactor concurrently: it does not provide concurrent building\nwithin a module (as Gradle does). One way to workaround this is to put each\nintegration test suite in its own Maven module (in a multi-module project) so\nthat the multi-threaded build system can run them in parallel. However, this\nconfiguration introduces a lot of boilerplate <code>pom.xml</code> code.</p>\n<h2>Conclusion</h2>\n<p>Maven’s Toolchains feature is great for separating your build’s JDK requirements\nfrom your code’s JDK requirements. We demonstrated how to use Maven Toolchains\nto re-run integration tests on multiple JDKs in a single Maven build. The code\nfor this example can be found on GitHub in\n<a href=\"https://github.com/gilday/maven-toolchains-testing\">gilday/maven-toolchains-testing</a>.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .solarized-light { background-color: #FDF6E3; }\n  .solarized-light .grvsc-tiaGIi-i { font-style: italic; }\n  .solarized-light .grvsc-tiaGIi-1 { color: #657B83; }\n  .solarized-light .grvsc-tiaGIi-7 { color: #268BD2; }\n  .solarized-light .grvsc-tiaGIi-3 { color: #93A1A1; }\n  .solarized-light .grvsc-tiaGIi-11 { color: #2AA198; }\n  .solarized-light .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n  \n  /* Solarized Dark */\n  @media (prefers-color-scheme: dark) {\n    .grvsc-mm-t6zo1R { background-color: #002B36; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-i { font-style: italic; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-3 { color: #657B83; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-7 { color: #268BD2; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-1 { color: #93A1A1; }\n    .grvsc-mm-t6zo1R .grvsc-t6zo1R-12 { color: #2AA198; }\n    .grvsc-mm-t6zo1R .grvsc-line-highlighted::before {\n      background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n      box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n    }\n  }\n</style>","frontmatter":{"title":"🦉 Testing Across JDKs with Maven Toolchains","date":"June 10, 2021","description":"Maven users who want to test their Java projects against different JDKs often do so by re-running their Maven build with each such JDK. Maven's Toolchains plugin offers an alternative strategy for testing across JDKs.\n"}}},"pageContext":{"slug":"/blog/maven-toolchain-tests/","previous":{"fields":{"slug":"/blog/owasp-xxe-jaxb/","sourceName":"blog"},"frontmatter":{"title":"🔒 XML External Entity Pitfalls With JAXB"}},"next":{"fields":{"slug":"/blog/stream-stax/","sourceName":"blog"},"frontmatter":{"title":"☕️ Connecting Java's Streaming API for XML (StAX) with Streams"}}}},"staticQueryHashes":["2841359383","614056702"],"slicesMap":{}}