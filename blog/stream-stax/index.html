<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.14.0"/><meta data-react-helmet="true" name="description" content="On one hand, Java developers love to work with streams of data using the `java.util.stream` package, because it is easy to apply transformations, filtering, and aggregation. On the other hand, the Streaming API for XML (StAX) makes reading XML streamwise easy, but there are no easy ways to filter, transform, and aggregate the data. How can a Java developer connect these two APIs to use the best of both?
"/><meta data-react-helmet="true" property="og:title" content="‚òïÔ∏è Connecting Java&#x27;s Streaming API for XML (StAX) with Streams"/><meta data-react-helmet="true" property="og:description" content="On one hand, Java developers love to work with streams of data using the `java.util.stream` package, because it is easy to apply transformations, filtering, and aggregation. On the other hand, the Streaming API for XML (StAX) makes reading XML streamwise easy, but there are no easy ways to filter, transform, and aggregate the data. How can a Java developer connect these two APIs to use the best of both?
"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="jdgilday"/><meta data-react-helmet="true" name="twitter:title" content="‚òïÔ∏è Connecting Java&#x27;s Streaming API for XML (StAX) with Streams"/><meta data-react-helmet="true" name="twitter:description" content="On one hand, Java developers love to work with streams of data using the `java.util.stream` package, because it is easy to apply transformations, filtering, and aggregation. On the other hand, the Streaming API for XML (StAX) makes reading XML streamwise easy, but there are no easy ways to filter, transform, and aggregate the data. How can a Java developer connect these two APIs to use the best of both?
"/><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><title data-react-helmet="true">‚òïÔ∏è Connecting Java&#x27;s Streaming API for XML (StAX) with Streams | Johnathan Gilday</title></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42.72rem;padding:2.67rem 1.335rem"><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.78 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:300;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:2.2974rem;line-height:2.67rem;letter-spacing:-2px;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}ul{margin-left:1.78rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.78rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;font-size:0.85rem;line-height:1.78rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;font-size:1rem;line-height:1.78rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}blockquote{margin-left:0;margin-right:1.78rem;margin-top:0;padding-bottom:0;padding-left:1.44625rem;padding-right:0;padding-top:0;margin-bottom:1.78rem;font-size:1.1487rem;line-height:1.78rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.33375rem solid hsla(0,0%,0%,0.2);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.78rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.78rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.78rem;margin-bottom:calc(1.78rem / 2);margin-top:calc(1.78rem / 2);}li > ul{margin-left:1.78rem;margin-bottom:calc(1.78rem / 2);margin-top:calc(1.78rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.78rem / 2);}code{font-size:0.85rem;line-height:1.78rem;}kbd{font-size:0.85rem;line-height:1.78rem;}samp{font-size:0.85rem;line-height:1.78rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.18667rem;padding-right:1.18667rem;padding-top:0.89rem;padding-bottom:calc(0.89rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:#f92300;text-decoration:none;}a:hover,a:active{text-decoration:underline;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.78rem;color:hsla(0,0%,0%,0.9);font-weight:300;}blockquote cite:before{content:"‚Äî ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.78rem;}blockquote{margin-left:-1.335rem;margin-right:0;padding-left:1.00125rem;}}@media only screen and (max-width:768px){h1{font-size:2rem;line-height:2.67rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.56rem;}a.gatsby-resp-image-link{box-shadow:none;}@media (prefers-color-scheme: dark){body{background-color:#121212;color:#ffffff;}a{color:#06ff68;}a.gatsby-resp-image-link{box-shadow:none;}blockquote{border-left-color:rgba(6, 255, 104);color:rgba(6, 255, 104, 0.64);}}</style><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a href="/blog/">/ gilday / blog</a></h3></header><main><article><header><h1 style="margin-top:1.78rem;margin-bottom:0">‚òïÔ∏è Connecting Java&#x27;s Streaming API for XML (StAX) with Streams</h1><p style="font-size:0.87055rem;line-height:1.78rem;display:block;margin-bottom:1.78rem">December 15, 2022</p></header><section><p>I recently had to process large XML documents in Java, so I reached for Java‚Äôs
Streaming API for XML (StAX). The document had a long list of relatively small
elements. Java‚Äôs new switch expressions made parsing the XML with StAX much
nicer than I remembered; however, I found myself missing the filtering,
transformation, and aggregation methods from <code>java.util.stream.Stream</code>.</p>
<p>I wanted to use StAX to parse the XML elements into a Java record, and I wanted
to use a <code>Stream</code> to process those records. In this blog post, I detail how to
do that efficiently.</p>
<h2>Parsing All the Sandwiches</h2>
<p>Consider an arbitrarily large XML document containing a list of favorite
sandwiches. Of course, we could parse all the favorite sandwiches into a
<code>java.util.Collection</code> then call <code>stream()</code>. However, we know this is not
efficient, because it requires the JVM to hold all the data from the large XML
document in memory.</p>
<pre class="grvsc-container solarized-light grvsc-mm-t6zo1R" data-language="java" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-3 grvsc-tiaGIi-i grvsc-t6zo1R-3 grvsc-t6zo1R-i">// ü§¢ Inefficient, because it reads all the records into memory before processing</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">List</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">&lt;</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">FavoriteSandwich</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">&gt; </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">sandwiches</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">parseAllSandwiches</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span><span class="grvsc-tiaGIi-11 grvsc-t6zo1R-12">&quot;./sandwiches.xml&quot;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">Stream</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">sandwichesStream</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">sandwiches</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">stream</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">();</span></span></span></code></pre>
<p>Instead, we want a <code>Stream</code> that parses the XML data as-needed. To build such a
stream, we define a new type that implements <code>java.util.stream.Spliterator</code>
interface. A <code>Spliterator</code> is the <code>java.util.stream</code> equivalent of a cursor, and
it facilitates making new <code>Stream</code> instances from data that can be iterated on
and optionally partitioned. In this example, the XML data is given to the
<code>Spliterator</code> as an <code>InputStream</code>, so it cannot be partitioned.</p>
<pre class="grvsc-container solarized-light grvsc-mm-t6zo1R" data-language="java" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">class</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-4">FavoriteSandwichXMLSpliterator</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">implements</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-8">Spliterator</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">&lt;</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">FavoriteSandwich</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">&gt; {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">private</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">final</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">XMLEventReader</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">reader</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">public</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">FavoriteSandwichXMLSpliterator</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">final</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">InputStream</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> is) </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">throws</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">IOException</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">try</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">      reader </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">factory</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">createXMLEventReader</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(is);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    } </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">catch</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> (</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">XMLStreamException</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> e) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">      </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">throw</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">new</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">IOException</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span><span class="grvsc-tiaGIi-11 grvsc-t6zo1R-12">&quot;Failed to parse favorite sandwiches from XML&quot;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">, e);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  ...</span></span></span></code></pre>
<p>The <code>Spliterator</code> parses the XML as-needed in its <code>tryAdvance</code> method.</p>
<pre class="grvsc-container solarized-light grvsc-mm-t6zo1R" data-language="java" data-index="2"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">@</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">Override</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">public</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">boolean</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">tryAdvance</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">final</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">Consumer</span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">&lt;?</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">super</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> FavoriteSandwich</span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">&gt;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> action) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">while</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> (</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">reader</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">hasNext</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">()) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">final</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">XMLEvent</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">event</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">try</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">      event </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">reader</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">nextEvent</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    } </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">catch</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> (</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">XMLStreamException</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> e) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">      </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">throw</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">new</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">UncheckedXMLStreamException</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span><span class="grvsc-tiaGIi-11 grvsc-t6zo1R-12">&quot;Failed to read favorite sandwiches from XML&quot;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">, e);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">if</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> (</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">event</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">isStartElement</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">()) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">      </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">final</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">StartElement</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">startElement</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">event</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">asStartElement</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">      </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">if</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> (</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">startElement</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">getName</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">().</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">getLocalPart</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">().</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">equals</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span><span class="grvsc-tiaGIi-11 grvsc-t6zo1R-12">&quot;favorite-sandwich&quot;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">)) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">        </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">final</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">FavoriteSandwich</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">sandwich</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">        </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">try</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">          sandwich </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">readSandwich</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(); </span><span class="grvsc-tiaGIi-3 grvsc-tiaGIi-i grvsc-t6zo1R-3 grvsc-t6zo1R-i">// implementation omitted for brevity</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">        } </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">catch</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> (</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">XMLStreamException</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> e) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">          </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">throw</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">new</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">UncheckedXMLStreamException</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span><span class="grvsc-tiaGIi-11 grvsc-t6zo1R-12">&quot;Failed to read favorite sandwich from XML&quot;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">, e);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">        </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">action</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">accept</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(sandwich);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">        </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">return</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-5 grvsc-t6zo1R-5">true</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">return</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-5 grvsc-t6zo1R-5">false</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">}</span></span></span></code></pre>
<p>The remaining methods of the <code>Spliterator</code> interface return values that
communicate to the <code>Stream</code> that we do not know how long the <code>Stream</code> is and it
cannot be partitioned. Finally, all this is encapsulated in a factory method
that returns a new <code>Stream</code>.</p>
<pre class="grvsc-container solarized-light grvsc-mm-t6zo1R" data-language="java" data-index="3"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">public</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">Stream</span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">&lt;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">FavoriteSandwich</span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">&gt;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">stream</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">final</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">InputStream</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> is) throws IOException {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">final</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">var</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">spliterator</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">new</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">FavoriteSandwichXMLSpliterator</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(is);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">return</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">StreamSupport</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">stream</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(spliterator, </span><span class="grvsc-tiaGIi-5 grvsc-t6zo1R-5">false</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">}</span></span></span></code></pre>
<p>This factory method provides the <code>Stream&#x3C;FavoriteSandwich></code> that developers want
to use while encapsulating the XML parsing that developers do not want to think
about. For example, it‚Äôs now incredibly simple to compute a count of favorite
sandwiches by the U.S. state they‚Äôre from:</p>
<pre class="grvsc-container solarized-light grvsc-mm-t6zo1R" data-language="java" data-index="4"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">@</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">Test</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">void</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">stream_all_valid_sandwiches</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">() throws IOException {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">final</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">FavoriteSandwichXMLParser</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">reader</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">new</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">FavoriteSandwichXMLParser</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">try</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> (</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">var</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">is</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">      </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">FavoriteSandwichXMLParserTest</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">class</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">getResourceAsStream</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span><span class="grvsc-tiaGIi-11 grvsc-t6zo1R-12">&quot;/favorite-sandwiches.xml&quot;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">)) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">var</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">sandwiches</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">reader</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">stream</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(is);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">final</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">Map</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">&lt;</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">String</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">, </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">Long</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">&gt; </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">countByState</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">        </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">sandwiches</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">collect</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">            </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">groupingBy</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(sandwich </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">-&gt;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">sandwich</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">restaurant</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">().</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">state</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(), </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">Collectors</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">counting</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">()));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">final</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">Map</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">&lt;</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">String</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">, </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">Long</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">&gt; </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">expected</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">Map</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">of</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span><span class="grvsc-tiaGIi-11 grvsc-t6zo1R-12">&quot;NJ&quot;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">, </span><span class="grvsc-tiaGIi-6 grvsc-t6zo1R-6">2L</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">, </span><span class="grvsc-tiaGIi-11 grvsc-t6zo1R-12">&quot;MD&quot;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">, </span><span class="grvsc-tiaGIi-6 grvsc-t6zo1R-6">3L</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">assertThat</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(countByState).</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">containsExactlyInAnyOrderEntriesOf</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(expected);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">}</span></span></span></code></pre>
<p>Perfect! ü•™</p>
<h2>Resource Management Special Case</h2>
<p>In the previous example, the <code>Stream&#x3C;FavoriteSandwich></code> data was processed
entirely within a try-with-resources statement that ensures the <code>InputStream</code>
will be closed. While this is ideal, it may not always be possible to manage the
IO resources this way. For example, consider the case where some existing method
expects a <code>Supplier&#x3C;Stream&#x3C;FavoriteSandwich>></code>. In this case, the <code>Supplier</code>
cannot use try-with-resources, because it cannot know when to close the
<code>InputStream</code>.</p>
<pre class="grvsc-container solarized-light grvsc-mm-t6zo1R" data-language="java" data-index="5"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-3 grvsc-tiaGIi-i grvsc-t6zo1R-3 grvsc-t6zo1R-i">// üêõ Will close the InputStream before any code can operate on the Stream</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">Supplier</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">&lt;</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">Stream</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">&lt;</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">FavoriteSandwich</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">&gt;&gt; </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">supplier</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> () </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">-&gt;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">try</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> (</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">var</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">is</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">      </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">FavoriteSandwichXMLParserTest</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">class</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">getResourceAsStream</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span><span class="grvsc-tiaGIi-11 grvsc-t6zo1R-12">&quot;/favorite-sandwiches.xml&quot;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">)) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">return</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">reader</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">stream</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(is);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  } </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">catch</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> (</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">IOException</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> e) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">throw</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">new</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">UncheckedIOException</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(e);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">};</span></span></span></code></pre>
<p>Instead, we want to clean-up the resources when the <code>Stream</code> has been closed.
Fortunately, <code>Stream</code> implements <code>AutoCloseable</code>, and the
<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/stream/Stream.html">Stream Javadoc</a>
instructs users to close streams that are backed by an IO channel.</p>
<blockquote>
<p>Streams have a BaseStream.close() method and implement AutoCloseable, but
nearly all stream instances do not actually need to be closed after use.
Generally, only streams whose source is an IO channel (such as those returned
by Files.lines(Path, Charset)) will require closing. Most streams are backed
by collections, arrays, or generating functions, which require no special
resource management. (If a stream does require closing, it can be declared as
a resource in a try-with-resources statement.)</p>
</blockquote>
<p>We can take advantage of this to handle this special case where the <code>Stream</code>
must clean-up the IO channel it encapsulates.</p>
<p>First, we make the <code>FavoriteSandwichXMLSpliterator</code> implement <code>AutoCloseable</code>.
The <code>close()</code> method simply closes the <code>InputStream</code> passed to the constructor
and propagates any exceptions as a <code>RuntimeException</code>.</p>
<pre class="grvsc-container solarized-light grvsc-mm-t6zo1R" data-language="java" data-index="6"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">@</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">Override</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">public</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">void</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">close</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">() {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">try</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">reader</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">close</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  } </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">catch</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> (</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">XMLStreamException</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> e) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">throw</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">new</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">UncheckedXMLStreamException</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span><span class="grvsc-tiaGIi-11 grvsc-t6zo1R-12">&quot;Failed to close XMLEventReader&quot;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">, e);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">}</span></span></span></code></pre>
<p>In this case, we define a new runtime exception <code>UncheckedXMLStreamException</code>
that is the StAX analog to <code>UncheckedIOException</code>.</p>
<p>Lastly, we change the factory that creates the <code>Stream</code>, so that the <code>Stream</code>
closes the <code>Spliterator</code> when it has been closed. This is made possible by the
<code>Stream.onClose(Runnable)</code> method that allows users to schedule arbitrary
routines to be executed when the <code>Stream</code> is closed.</p>
<pre class="grvsc-container solarized-light grvsc-mm-t6zo1R" data-language="java" data-index="7"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">public</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">Stream</span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">&lt;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">FavoriteSandwich</span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">&gt;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">stream</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">final</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">InputStream</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> is) throws IOException {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">final</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">var</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">spliterator</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">new</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">FavoriteSandwichXMLSpliterator</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(is);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">return</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">StreamSupport</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">stream</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(spliterator, </span><span class="grvsc-tiaGIi-5 grvsc-t6zo1R-5">false</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">).</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">onClose</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(spliterator</span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">::</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">close);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">}</span></span></span></code></pre>
<p>Having made these changes, the <code>Stream</code> itself may be in a try-with-resources to
ensure that the IO is closed properly:</p>
<pre class="grvsc-container solarized-light grvsc-mm-t6zo1R" data-language="java" data-index="8"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">void</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">process</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">final</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">Supplier</span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">&lt;</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">Stream</span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">&lt;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">FavoriteSandwich</span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">&gt;&gt;</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> supplier) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">try</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> (</span><span class="grvsc-tiaGIi-13 grvsc-tiaGIi-b grvsc-t6zo1R-1 grvsc-t6zo1R-b">var</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">sandwiches</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">=</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1"> </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">supplier</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">get</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">()) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">    </span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">sandwiches</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">forEach</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">(</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">System</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">.</span><span class="grvsc-tiaGIi-7 grvsc-t6zo1R-7">out</span><span class="grvsc-tiaGIi-8 grvsc-t6zo1R-9">::</span><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">println);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="grvsc-tiaGIi-1 grvsc-t6zo1R-1">}</span></span></span></code></pre>
<h2>Conclusion</h2>
<p>Arbitrarily large streams of data, such as a large XML document, are ripe for
processing with the <code>java.util.stream</code> APIs, but developers need way to parse
records from the stream as-needed and expose those elements as a <code>Stream</code>. The
<code>Spliterator</code> interface is the key that unlocks the power of the <code>Stream</code> API
for data that may be processed stream-wise. Additionally, when the <code>Stream</code> must
also clean-up the underlying IO resources after it has been exhausted, the
<code>Stream.onClose(Runnable)</code> method is available to schedule that clean-up.</p>
<p>The accompanying code may be found at
<a href="https://github.com/gilday/how-to-stream-stax">gilday/how-to-stream-stax</a>.</p>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .solarized-light { background-color: #FDF6E3; }
  .solarized-light .grvsc-tiaGIi-b { font-weight: bold; }
  .solarized-light .grvsc-tiaGIi-i { font-style: italic; }
  .solarized-light .grvsc-tiaGIi-3 { color: #93A1A1; }
  .solarized-light .grvsc-tiaGIi-13 { color: #073642; }
  .solarized-light .grvsc-tiaGIi-1 { color: #657B83; }
  .solarized-light .grvsc-tiaGIi-7 { color: #268BD2; }
  .solarized-light .grvsc-tiaGIi-8 { color: #859900; }
  .solarized-light .grvsc-tiaGIi-11 { color: #2AA198; }
  .solarized-light .grvsc-tiaGIi-5 { color: #B58900; }
  .solarized-light .grvsc-tiaGIi-6 { color: #D33682; }
  .solarized-light .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));
  }
  
  /* Solarized Dark */
  @media (prefers-color-scheme: dark) {
    .grvsc-mm-t6zo1R { background-color: #002B36; }
    .grvsc-mm-t6zo1R .grvsc-t6zo1R-b { font-weight: bold; }
    .grvsc-mm-t6zo1R .grvsc-t6zo1R-i { font-style: italic; }
    .grvsc-mm-t6zo1R .grvsc-t6zo1R-3 { color: #657B83; }
    .grvsc-mm-t6zo1R .grvsc-t6zo1R-1 { color: #93A1A1; }
    .grvsc-mm-t6zo1R .grvsc-t6zo1R-7 { color: #268BD2; }
    .grvsc-mm-t6zo1R .grvsc-t6zo1R-9 { color: #859900; }
    .grvsc-mm-t6zo1R .grvsc-t6zo1R-12 { color: #2AA198; }
    .grvsc-mm-t6zo1R .grvsc-t6zo1R-4 { color: #CB4B16; }
    .grvsc-mm-t6zo1R .grvsc-t6zo1R-8 { color: #6C71C4; }
    .grvsc-mm-t6zo1R .grvsc-t6zo1R-5 { color: #B58900; }
    .grvsc-mm-t6zo1R .grvsc-t6zo1R-6 { color: #D33682; }
    .grvsc-mm-t6zo1R .grvsc-line-highlighted::before {
      background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
      box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
    }
  }
</style></section><hr style="margin-bottom:1.78rem"/><footer><div style="display:flex;margin-bottom:4.45rem"><div data-gatsby-image-wrapper="" style="position:relative;overflow:hidden;width:50px;height:50px;margin-right:0.89rem;margin-bottom:0;min-width:50px;border-radius:100%" class="gatsby-image-wrapper"><div aria-hidden="true" data-placeholder-image="" style="height:100%;left:0;position:absolute;top:0;width:100%"></div><picture><source type="image/webp" data-srcset="/static/22d7c60e65a56e5da11fd167da768779/dbc4a/profile-pic.webp 50w,/static/22d7c60e65a56e5da11fd167da768779/d8057/profile-pic.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" data-main-image="" style="height:100%;left:0;position:absolute;top:0;transform:translateZ(0);transition:opacity 250ms linear;width:100%;will-change:opacity;border-radius:50%;opacity:0" sizes="50px" decoding="async" loading="lazy" data-src="/static/22d7c60e65a56e5da11fd167da768779/6ac16/profile-pic.jpg" data-srcset="/static/22d7c60e65a56e5da11fd167da768779/6ac16/profile-pic.jpg 50w,/static/22d7c60e65a56e5da11fd167da768779/e07e1/profile-pic.jpg 100w" alt="Johnathan Gilday"/></picture><noscript><picture><source type="image/webp" srcSet="/static/22d7c60e65a56e5da11fd167da768779/dbc4a/profile-pic.webp 50w,/static/22d7c60e65a56e5da11fd167da768779/d8057/profile-pic.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" data-main-image="" style="height:100%;left:0;position:absolute;top:0;transform:translateZ(0);transition:opacity 250ms linear;width:100%;will-change:opacity;border-radius:50%;opacity:0" sizes="50px" decoding="async" loading="lazy" src="/static/22d7c60e65a56e5da11fd167da768779/6ac16/profile-pic.jpg" srcSet="/static/22d7c60e65a56e5da11fd167da768779/6ac16/profile-pic.jpg 50w,/static/22d7c60e65a56e5da11fd167da768779/e07e1/profile-pic.jpg 100w" alt="Johnathan Gilday"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><p>Written by<!-- --> <strong><a href="/">Johnathan Gilday</a></strong>. <!-- -->Red Bank, NJ, USA based software developer.</p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/blog/maven-toolchain-tests/">‚Üê <!-- -->ü¶â Testing Across JDKs with Maven Toolchains</a></li><li><a rel="next" href="/blog/java-nio-files/">‚òïÔ∏è Reasons to Prefer Java&#x27;s New I/O for Working With Files<!-- --> ‚Üí</a></li></ul></nav></main><footer>¬© <!-- -->2025<!-- -->, <!-- -->Johnathan Gilday<!-- --> </footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-E3KXE45ML7"></script><script>
      
      
      if(!(navigator.doNotTrack == "1" || window.doNotTrack == "1")) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-E3KXE45ML7', {"anonymize_ips":true,"send_page_view":false});
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/stream-stax/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-7e0fc212cfa9dd5d342d.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-a1a4d2a112703f6cc7e8.js\"],\"component---src-pages-blog-tsx\":[\"/component---src-pages-blog-tsx-82d777427dabcbc6eac5.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-b9e7e8945d25eb738e0a.js\"],\"component---src-pages-resume-tsx\":[\"/component---src-pages-resume-tsx-1df92d269bdb74e5a892.js\"],\"component---src-templates-blog-post-js\":[\"/component---src-templates-blog-post-js-ad64d9c9707e228f69ed.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="f5d92446512b38f643cb";</script><script src="/webpack-runtime-903c1c9e88b35fe02b86.js" async></script><script src="/framework-6075b4dc61d6609a7a2a.js" async></script><script src="/app-7e0fc212cfa9dd5d342d.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>