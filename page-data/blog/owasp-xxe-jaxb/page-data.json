{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/owasp-xxe-jaxb/","result":{"data":{"site":{"siteMetadata":{"author":{"name":"Johnathan Gilday"},"blogTitle":"/ gilday / blog"}},"markdownRemark":{"id":"a138345d-0336-5b23-a46f-23343fb0faf0","excerpt":"I work on a Java agent tool at Contrast Security that detects web application\nvulnerabilities at runtime. Recently, Contrast reported an XML External Entities‚Ä¶","html":"<p>I work on a Java agent tool at Contrast Security that detects web application\nvulnerabilities at runtime. Recently, Contrast reported an XML External Entities\n(XXE) vulnerability in a user‚Äôs web application that uses JAXB to parse XML. The\nuser questioned the validity of this vulnerability report. This user‚Äôs false\npositive claim sent me down the rabbit hole researching what I called Java XML\nHell. This research ultimately resulted in a change to\n<a href=\"https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html\">OWASP‚Äôs XXE Cheat Sheet</a>.\nI discovered that securing JAXB against XXE attacks is really difficult, and the\nContrast Java agent accurately reported the application to be vulnerable üôå.</p>\n<p>Before accepting our proposed changes, the OWASP XXE Cheat Sheet advised OpenJDK\n1.8 users that their JAXB applications are safe from XXE attacks. The advice\nread:</p>\n<blockquote>\n<p>Since JDK-8010393, which is in OpenJDK 8 beta 86,\n<code>javax.xml.bind.Unmarshaller</code> instances are safe by default. The other classes\nmentioned here are still unsafe by default in Java 8.</p>\n</blockquote>\n<p>While researching this issue, I discovered that an application parsing untrusted\nXML on an OpenJDK 1.8 runtime may be vulnerable to XXE when:</p>\n<ul>\n<li>the JAXB runtime has been inadvertently replaced with a different JAXB runtime\nthat is not safe-by-default (e.g. EclipseLink MOXy)</li>\n<li>the secure SAX parser that the OpenJDK 1.8 <code>Unmarshaller</code> uses has been\ninadvertently replaced with a different implementation that is not\nsafe-by-default (e.g. xercesImpl:2.8.0)</li>\n<li>the application uses one of the <code>unmarshal</code> overloads that does not delegate\nXML parsing to the safe-by-default SAX parser</li>\n</ul>\n<p>Given all of these caveats, I do not think that OpenJDK 1.8 users should assume\nthat their JAXB <code>Unmarshaller</code> is safe from XXE attacks by default.</p>\n<p>Contrast Security\n<a href=\"https://www.contrastsecurity.com/security-influencers/xml-xxe-pitfalls-with-jaxb\">published my research to its Security Influencer‚Äôs blog</a>,\nand\n<a href=\"https://github.com/OWASP/CheatSheetSeries/issues/488\">OWASP accepted my change request</a>\nto remove the misleading guidance from its XXE Cheat Sheet.</p>\n<p>This is not the first time I have written about securing XML and Java. Last\nyear, I wrote an article for Baeldung about how to\n<a href=\"https://www.baeldung.com/java-xstream-remote-code-execution\">secure XStream from Remote Code Exploitation</a>.\nOne thing I have learned at Contrast Security is that tracing the relationships\nbetween the various Java XML technologies and how to secure them is enough to\nmake anyone‚Äôs head spin!</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","frontmatter":{"title":"üîí XML External Entity Pitfalls With JAXB","date":"September 16, 2020","description":"I spent a few weeks in \"Java XML Hell\", and I learned that securely parsing untrusted XML in Java is more difficult than it seems. Contrast Security published my research to its Security Influencers blog, and OWASP accepted my change request to remove misleading guidance from its XXE Cheat Sheet.\n"}}},"pageContext":{"slug":"/blog/owasp-xxe-jaxb/","previous":{"fields":{"slug":"/blog/macos-homebrew-openjdk/","sourceName":"blog"},"frontmatter":{"title":"üçé Installing and Managing Java on macOS"}},"next":{"fields":{"slug":"/blog/maven-toolchain-tests/","sourceName":"blog"},"frontmatter":{"title":"ü¶â Testing Across JDKs with Maven Toolchains"}}}},"staticQueryHashes":["2841359383","614056702"],"slicesMap":{}}